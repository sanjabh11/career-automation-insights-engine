# 0001-12 T4: Cross-field validation for APO

## Description
Add cross-field validation to ensure LLM outputs are internally consistent with deterministic aggregation logic.

## Status History
- 2025-08-12T14:27:15+05:30: user_approves (Proposed -> Agreed) by User
- 2025-08-12T14:27:15+05:30: start_work (Agreed -> InProgress) by AI_Agent

## Requirements
- Validate that `category_apos[cat].apo` aligns with weighted mean of `items` in that category within Â±5 points; record warning if violated.
- Do not fail the request; use deterministic computed results regardless of model `category_apos`.
- Persist validation warnings to telemetry (`apo_logs.validation_warnings`).

## Implementation Plan
- Implement `computeCategoryMeans(items)`.
- Compare against `apo.category_apos` and aggregate warnings.
- Extend telemetry insert to include warnings as JSON.

## Test Plan
- Inject synthetic responses with misaligned `category_apos` and assert warnings captured.
- Validate that main response remains computed from deterministic pipeline.

## Files Modified
- `supabase/functions/calculate-apo/index.ts`
- `supabase/migrations/<ts>_alter_apo_logs_add_validation_cols.sql`
