# PBI-0001-22: Course Search – Real Data Only (Remove Mock Defaults)

Type: code
Status: InProgress

## Goal
Ensure `course-search` returns only real data from SerpAPI without fabricating ratings/prices, and gate fallback courses behind an explicit env flag.

## Files
- `supabase/functions/course-search/index.ts`

## Changes
- Stop returning random ratings when not provided; prefer `rating` omitted (or null) rather than fabricated values.
- Stop provider-based default pricing; return `"Unknown"` when price can’t be inferred.
- Gate fallback courses with `COURSE_SEARCH_ALLOW_FALLBACKS=true` (default off). When disabled, no fallback courses are injected.

## Test Plan
1. With `COURSE_SEARCH_ALLOW_FALLBACKS` unset:
   - POST to `course-search` with a real skill payload returns only real results.
   - Items without ratings have rating omitted.
   - Items without price show `"Unknown"`.
   - No fallback courses appear when results are < 6.
2. With `COURSE_SEARCH_ALLOW_FALLBACKS=true`:
   - When fewer than 6 items, fallback items appear at the end, clearly real-domain links (Coursera/edX search pages) with known text.
3. Error handling:
   - If SerpAPI error occurs, response contains `error` and `courses: []` without fabricated data.

## Rollback Plan
Revert the file to prior version.
