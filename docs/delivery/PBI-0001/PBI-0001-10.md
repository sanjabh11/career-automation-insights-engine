# 0001-10 T2: APO telemetry logging

## Description
Create persistent telemetry for APO runs to support auditing, evaluation, and iterative tuning.
- New table: `apo_logs`
- Log from `supabase/functions/calculate-apo/index.ts` each run with inputs (occupation, prompt hash), model, effective generationConfig, model JSON (validated), computed items/category/overall, weights, timeline, insights, and latency/errors.

## Status History
- 2025-08-12T13:52:18+05:30: user_approves (Proposed -> Agreed) by User
 - 2025-08-12T13:58:40+05:30: start_work (Agreed -> InProgress) by AI_Agent

## Requirements
- Privacy: store prompt hash, not raw prompt text.
- PII-safe: occupation code/title only.
- Insert on every APO call; non-blocking failure (do not break API response on log error).

## Implementation Plan
- Add migration `supabase/migrations/<ts>_create_apo_logs.sql` to create table with appropriate columns and indexes.
- In `calculate-apo/index.ts`:
  - Compute `promptHash` via SHA-256 of the prompt.
  - Capture `effectiveModel` and `effectiveGenerationConfig`.
  - Insert structured row into `apo_logs` using service role client.
  - Wrap in try/catch; ignore insert errors while logging to console.

## Test Plan
- Apply migration locally and verify table exists.
- Trigger APO; confirm row appears with expected fields and values.
- Simulate insert failure (remove service key); ensure API still returns APO response.

## Verification
- New rows are created for each APO call; structure matches design.
- No user-facing regressions.

## Files Modified
- `supabase/functions/calculate-apo/index.ts`
- `supabase/migrations/<ts>_create_apo_logs.sql`
