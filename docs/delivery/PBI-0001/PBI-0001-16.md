# 0001-16 E2E CoS Test for APO Pipeline

## Description
Define and execute an end-to-end test that verifies the PBI-0001 Conditions of Satisfaction (CoS) for the APO pipeline after deployment to Supabase Cloud.

## Status History
- 2025-08-23 user_approves: Proposed -> Agreed (Cascade)

## Requirements
- Call `calculate-apo` with a known occupation and assert:
  - 200 OK and JSON response
  - Includes flattened fields and `analysis` wrapper
  - Contains `categoryBreakdown`, `overallAPO`, and `metadata.weights_used`
  - Rate limit headers are present
  - Telemetry row appears in `apo_logs` with `occupation_code/title` and `prompt_hash`
- Toggle `apo_config` values (e.g., tech weight) and verify effect on output

## Implementation Plan
- Write a Postman collection or a small script (Deno/Node) to:
  - Issue request(s) to Edge Function
  - Capture and assert headers/body
  - Query `apo_logs` (admin client) to verify telemetry
- Document steps in `docs/technical/calculate-apo.md` (Smoke Test section)

## Test Plan
- Staging project: run collection with 2 occupations
- Verify rate limit headers and handling of subsequent requests beyond limit -> 429
- Change `apo_config.weights.technologies` from 0.25 to 0.35; re-run and confirm higher tech influence

## Verification
- All assertions pass; screenshots or console output saved in repo (artifacts folder)

## Files Modified
- N/A (test artifacts outside function code)
