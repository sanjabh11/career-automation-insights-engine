# PBI-0001-6 Gemini Edge Function

**Back to Task Index**: [Tasks for PBI PBI-0001](./tasks.md)

## Description
Implement a secure Supabase Edge Function `gemini-generate` that calls Google Gemini using the server-side `GEMINI_API_KEY`. Refactor frontend `GeminiService` and ensure `useGemini` routes all calls through this Edge Function to remove any client-side key exposure.

## Status History
- 2025-08-11 | Proposed -> InProgress | Create Edge Function and refactor service to call it
- 2025-08-11 | InProgress -> Review | Function working locally; frontend wired; awaiting E2E validation

## Requirements
- All Gemini calls must run server-side via `supabase/functions/gemini-generate`.
- Use secret `GEMINI_API_KEY` only on serverâ€”no client exposure.
- Return a normalized `GeminiResponse` to the frontend.
- Include error handling and useful logs (without leaking secrets).

## Implementation Plan
- Create `supabase/functions/gemini-generate/index.ts` to proxy Gemini API.
- Refactor `src/services/GeminiService.ts` to invoke the Edge Function via Supabase client.
- Update `src/hooks/useGemini.ts` usage/comments to reflect server-side invocation.
- Verify all previous direct Gemini API references are removed from the client.

## Test Plan
- Unit (light): Validate service method shapes and error paths.
- Integration: Invoke Edge Function with a simple prompt; assert 200 and response shape.
- E2E: Trigger Gemini-powered UI flow (e.g., task analysis); confirm no network to googleapis from browser and results render.

## Verification
- Network inspection in browser shows calls only to Supabase Edge Function, not googleapis.
- Calls succeed with real `GEMINI_API_KEY` configured server-side.
- Error states handled gracefully with non-sensitive messages.

## Files Modified
- supabase/functions/gemini-generate/index.ts (added previously)
- src/services/GeminiService.ts (refactored)
- src/hooks/useGemini.ts (updated docs/usage)
