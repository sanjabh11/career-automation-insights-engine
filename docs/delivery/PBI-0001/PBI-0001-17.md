# 0001-17 DB constraint: One active apo_config

## Description
Enforce that at most one row in `public.apo_config` can be active at any time, preventing ambiguous runtime configuration.

## Status History
- 2025-08-23 start_work: Proposed -> InProgress (Cascade)

## Requirements
- Create a partial unique index on `(is_active)` where `is_active = true`.
- Avoid breaking existing inactive/archived rows.
- Document behavior and index purpose.

## Implementation Plan
- Add migration `supabase/migrations/20250823184000_apo_config_one_active.sql`:
  - `create unique index if not exists apo_config_one_active_idx on public.apo_config (is_active) where is_active;`
  - Add comment for maintainers.

## Test Plan
- Insert an active row when none exists -> OK.
- Insert a second active row -> should fail with unique violation.
- Set previous active row to false, then insert new active -> OK.

## Verification
- Unique index exists and enforces constraint in staging and production.

## Files Modified
- `supabase/migrations/20250823184000_apo_config_one_active.sql` (NEW)
