# PBI-0001-25: Unify Gemini Model Usage via Env

Type: code
Status: InProgress

## Goal
Ensure all Edge Functions that call Gemini use the centralized env-driven model selection and generation defaults from `supabase/lib/GeminiClient.ts` (`getEnvModel`, `getEnvGenerationDefaults`). Remove direct references to specific model strings (e.g., `gemini-2.0-flash-exp`).

## Files
- `supabase/functions/analyze-occupation-tasks/index.ts`
- `supabase/functions/assess-task/index.ts`

## Changes
- Import `{ getEnvModel, getEnvGenerationDefaults }` and build the model URL dynamically.
- Merge `getEnvGenerationDefaults()` with the per-call overrides.

## Test Plan
1. With `GEMINI_MODEL` unset: functions default to `gemini-2.5-flash` and return valid responses.
2. With `GEMINI_MODEL=gemini-1.5-flash`: functions use the configured model and return valid responses.
3. Error path: If `GEMINI_API_KEY` is missing, functions fail with `Gemini API key is not configured`.

## Rollback Plan
Revert the function files to their previous versions.
