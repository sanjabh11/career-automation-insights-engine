# PBI-0003-T1 Create `/intelligent-task-assessment` Edge Function

## Description
Create a Supabase Edge Function that receives a list of tasks and returns their automation category (Automate/Augment/Human-only), score, confidence, and reasoning. The result should be stored in `ai_task_assessments`.

## Status History
| Timestamp | Event | From | To | Details | User |
|-----------|-------|------|----|---------|------|
| 2025-08-07 | user_approves | Proposed | Agreed | Task created & approved. | User |

## Requirements
1. **Endpoint**: `POST /intelligent-task-assessment`
2. **Input Schema**:
   ```json
   {
     "occupationCode": "string",
     "occupationTitle": "string",
     "tasks": ["string"],
     "userId": "uuid"
   }
   ```
3. **Processing**:
   1. For each task, call Gemini 2.5 Flash with the prompt template from `LLM.md`.
   2. Parse and validate response with Zod.
   3. Insert each assessment into `ai_task_assessments` with foreign key `user_id`.
4. **Output**: aggregated array of assessment results.
5. **Tests**: unit tests for schema validation, DB insert, error fallback.

## Implementation Plan
1. Scaffold function at `supabase/functions/intelligent-task-assessment/index.ts`.
2. Import `GeminiClient` wrapper.
3. Implement loop with `Promise.all` for tasks.
4. Use Supabase JS client with service role key for DB insert.
5. Write jest tests in `supabase/tests/intelligent-task-assessment.test.ts`.

## Test Plan
- **Unit**: Validate correct insertion and response format.
- **Integration**: Live call on staging with 3 test tasks.

## Verification
- Confirm rows in `ai_task_assessments` table.
- Endpoint returns JSON array with categories & scores.

## Files Modified / Added
- `supabase/functions/intelligent-task-assessment/index.ts`
- `supabase/tests/intelligent-task-assessment.test.ts`
